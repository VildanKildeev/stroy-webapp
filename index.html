<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>СТРОЙ по КАрману</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        /* ... (предыдущие стили остаются без изменений) ... */
        
        /* Новые стили для инструкции */
        .copy-instructions {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
            line-height: 1.4;
            text-align: left;
            max-width: 300px;
        }
        .copy-steps {
            margin: 10px 0;
            padding-left: 20px;
        }
        .copy-steps li {
            margin-bottom: 8px;
            position: relative;
        }
        .copy-steps li:before {
            content: "•";
            position: absolute;
            left: -15px;
            color: #3498db;
            font-weight: bold;
        }
        .copy-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #3498db;
            text-align: center;
        }
        .ios-telegram-warning {
            display: none;
            background: rgba(200, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- ... (остальная часть HTML без изменений) ... -->

    <!-- Модалка для iOS -->
    <div class="modal" id="phoneModal">
        <button class="close-modal">×</button>
        <div class="modal-content phone-modal-content">
            <div class="modal-title">Позвонить</div>
            <div class="phone-number" id="displayPhoneNumber"></div>
            
            <!-- Предупреждение для iOS в Telegram -->
            <div class="ios-telegram-warning" id="iosTelegramWarning">
                В приложении Telegram для iOS звонки недоступны.<br>
                Скопируйте номер и вставьте в приложение "Телефон"
            </div>
            
            <div class="modal-buttons">
                <button class="modal-button" id="directCallButton">ПОЗВОНИТЬ</button>
                <button class="modal-button" id="copyPhoneButton">СКОПИРОВАТЬ НОМЕР</button>
            </div>
            
            <!-- Инструкция по копированию для iOS -->
            <div class="copy-instructions" id="copyInstructions">
                <div class="copy-title">Как позвонить:</div>
                <ol class="copy-steps">
                    <li>Нажмите "Скопировать номер"</li>
                    <li>Откройте приложение "Телефон"</li>
                    <li>Перейдите на вкладку "Клавиатура"</li>
                    <li>Нажмите и удерживайте поле ввода номера</li>
                    <li>Выберите "Вставить" во всплывающем меню</li>
                    <li>Нажмите зеленую кнопку вызова</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // ... (предыдущий код JavaScript без изменений) ...
        
        // Универсальная функция для звонка
        function callPhone(phoneNumber) {
            playSound();
            currentPhoneNumber = phoneNumber;
            const formatted = formatPhone(phoneNumber);

            // Показываем модалку
            document.getElementById('displayPhoneNumber').textContent = formatted;
            
            // Показываем инструкцию для iOS
            document.getElementById('copyInstructions').style.display = 
                isIOS ? 'block' : 'none';
            
            // Показываем предупреждение только для Telegram на iOS
            document.getElementById('iosTelegramWarning').style.display = 
                isTelegramIOS ? 'block' : 'none';
            
            closeAllModals();
            setTimeout(() => {
                document.getElementById('phoneModal').classList.add('active');
            }, 100);

            // Для Safari на iOS пробуем автоматический звонок
            if (isSafariIOS) {
                setTimeout(() => {
                    try {
                        const a = document.createElement('a');
                        a.href = `tel:${phoneNumber}`;
                        a.style.display = 'none';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    } catch (e) {
                        console.log("Автозвонок не удался", e);
                    }
                }, 500);
            }
        }

        // ... (остальной код JavaScript без изменений) ...
    </script>
</body>
</html>